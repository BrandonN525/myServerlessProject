service: myserverlessproject
frameworkVersion: '2'

provider:
  name: aws
  runtime: nodejs12.x
  lambdaHashingVersion: 20201221
  profile: serverlessUser
  environment:
        tableName: player-points
        bucketName: upload-bucket-100015
  iamRoleStatements:
      - Effect: Allow
        Action:
          - dynamodb:*
          - s3:*
        Resource: '*'

plugins:
    - serverless-s3-sync

functions:
    getUser:
        handler: lambdas/endpoints/getUser.handler
        events:
            - http:
                  path: get-user/{ID}
                  method: GET
                  cors: true

    getPlayerScore:
        handler: lambdas/endpoints/getPlayerScore.handler
        events:
            - http:
                  path: get-player-score/{ID}
                  method: GET
                  cors: true

    createPlayerScore:
        handler: lambdas/endpoints/createPlayerScore.handler
        events:
            - http:
                  path: create-player-score/{ID}
                  method: POST
                  cors: true

    createFile:
        handler: lambdas/endpoints/createFile.handler
        events:
            - http:
                  path: create-file/{fileName}
                  method: POST
                  cors: true

resources:
    Resources:
        DemoBucketUpload:
            Type: AWS::S3::Bucket
            Properties:
                BucketName: serverlessbucket10015

        MyDynamoDbTable:
            Type: AWS::DynamoDB::Table
            Properties:
                TableName: player-points
                AttributeDefinitions:
                    - AttributeName: ID
                      AttributeType: S
                KeySchema:
                    - AttributeName: ID
                      KeyType: HASH
                BillingMode: PAY_PER_REQUEST

custom:
    s3Sync:
        - bucketName: serverlessbucket10015
          localDir: UploadData

    s3UploadBucket:
        Type: AWS::S3::Bucket
        Properties:
            BucketName: upload-bucket-100015